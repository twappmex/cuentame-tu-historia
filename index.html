<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cu√©ntame tu historia</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Biblioteca para exportar a PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #6a5acd;
            --secondary-color: #9370db;
            --accent-color: #ffa07a;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --neutral-light: #e9ecef;
            --neutral-medium: #ced4da;
            --neutral-dark: #adb5bd;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        /* Tema para Mam√° */
        .theme-mama {
            --primary-color: #9c27b0;
            --secondary-color: #ba68c8;
            --accent-color: #ff80ab;
        }

        /* Tema para Pap√° */
        .theme-papa {
            --primary-color: #2196f3;
            --secondary-color: #64b5f6;
            --accent-color: #4dd0e1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-color);
            color: var(--dark-color);
            line-height: 1.6;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            box-shadow: var(--shadow);
        }

        /* Estilos para el sistema de autenticaci√≥n */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }

        .auth-box {
            background-color: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .auth-box h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }

        .auth-form .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .auth-form label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
            font-weight: 600;
        }

        .auth-form input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--neutral-medium);
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        .auth-form button {
            width: 100%;
            padding: 0.8rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .auth-form button:hover {
            background-color: var(--secondary-color);
        }

        .auth-toggle {
            margin-top: 1.5rem;
            color: var(--dark-color);
        }

        .auth-toggle a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }

        .auth-toggle a:hover {
            text-decoration: underline;
        }

        .app-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-bottom: 4px solid var(--accent-color);
            position: relative;
            display: none; /* Oculto inicialmente hasta el login */
        }

        .parent-selector {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .parent-btn {
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .parent-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .parent-btn.active {
            background-color: white;
            color: var(--primary-color);
            font-weight: 600;
        }

        .logo-container {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .logo {
            width: 50px;
            height: 50px;
            margin-right: 1rem;
            border-radius: 50%;
            object-fit: cover;
        }

        .app-header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .nav-menu {
            display: flex;
            justify-content: center;
            width: 100%;
            gap: 0.5rem;
        }

        .nav-btn {
            background-color: transparent;
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
        }

        .nav-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .nav-btn.active {
            background-color: white;
            color: var(--primary-color);
            font-weight: 600;
        }

        .main-content {
            flex: 1;
            padding: 2rem;
            position: relative;
            display: none; /* Oculto inicialmente hasta el login */
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .welcome-container {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: linear-gradient(rgba(106, 90, 205, 0.9), rgba(147, 112, 219, 0.9)), url('https://images.unsplash.com/photo-1529333166437-7750a6dd5a70?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            color: white;
        }

        .welcome-container h2 {
            color: white;
            margin-bottom: 1rem;
            font-size: 2rem;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }

        .welcome-container p {
            color: white;
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .progress-container {
            width: 100%;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            margin: 1.5rem 0;
            box-shadow: var(--shadow);
            position: relative;
            height: 40px;
        }

        .progress-bar {
            height: 100%;
            border-radius: 20px;
            background: linear-gradient(to right, var(--accent-color), var(--primary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: width 0.5s ease;
            position: relative;
            min-width: 60px;
        }

        .progress-text {
            position: absolute;
            width: 100%;
            text-align: center;
            z-index: 2;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .welcome-animation {
            display: flex;
            justify-content: center;
            margin: 2rem 0;
            gap: 1rem;
        }

        .animation-circle {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: var(--accent-color);
            animation: bounce 1.5s infinite ease-in-out;
        }

        .animation-circle:nth-child(2) {
            animation-delay: 0.2s;
        }

        .animation-circle:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        .cta-button {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .cta-button:hover {
            background-color: #ff8c61;
            transform: translateY(-2px);
        }

        .recent-entries {
            margin-top: 2rem;
        }

        .section-header {
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
        }

        .section-header h2 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .export-buttons {
            position: absolute;
            top: 0;
            right: 0;
            display: flex;
            gap: 0.5rem;
        }

        .export-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            font-size: 0.8rem;
        }

        .export-btn:hover {
            background-color: var(--secondary-color);
        }

        .entries-grid, .questions-grid, .memories-grid, .favorites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .entry-card, .question-card, .memory-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: var(--transition);
            border: 1px solid var(--neutral-medium);
            cursor: pointer;
        }

        .entry-card:hover, .question-card:hover, .memory-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .entry-header, .memory-header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            position: relative;
        }

        .entry-header h3, .memory-header h3 {
            font-size: 1.1rem;
            margin-bottom: 0.3rem;
        }

        .entry-date, .memory-date {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .entry-content, .memory-content {
            padding: 1rem;
            font-size: 0.9rem;
            color: var(--dark-color);
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .entry-actions, .memory-actions {
            padding: 0.5rem 1rem;
            display: flex;
            justify-content: space-between;
            border-top: 1px solid var(--neutral-medium);
        }

        .action-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
        }

        .action-button:hover {
            background-color: var(--secondary-color);
        }

        .question-categories {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .category-btn {
            background-color: var(--neutral-light);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .category-btn:hover {
            background-color: var(--neutral-medium);
        }

        .category-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        .question-card {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .question-card h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .question-card p {
            font-size: 0.9rem;
            margin-bottom: 1rem;
            color: var(--dark-color);
        }

        .answer-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            margin-top: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .answer-btn:hover {
            background-color: #ff8c61;
        }

        .answer-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: var(--neutral-medium);
        }

        .memory-media {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-bottom: 1px solid var(--neutral-medium);
        }

        .memories-actions {
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 2rem;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--neutral-dark);
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--danger-color);
        }

        .modal h3 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .modal textarea {
            width: 100%;
            min-height: 200px;
            padding: 1rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--neutral-medium);
            resize: vertical;
            margin-bottom: 1.5rem;
            font-size: 1rem;
        }

        .modal-actions, .form-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .modal-btn {
            padding: 0.7rem 1.5rem;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .save-btn {
            background-color: var(--success-color);
            color: white;
        }

        .save-btn:hover {
            background-color: #218838;
        }

        .cancel-btn {
            background-color: var(--neutral-light);
            color: var(--dark-color);
        }

        .cancel-btn:hover {
            background-color: var(--neutral-medium);
        }

        .edit-btn {
            background-color: var(--primary-color);
            color: white;
        }

        .edit-btn:hover {
            background-color: var(--secondary-color);
        }

        .favorite-btn {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }

        .favorite-btn:hover {
            background-color: #e0a800;
        }

        .close-btn {
            background-color: var(--danger-color);
            color: white;
        }

        .close-btn:hover {
            background-color: #c82333;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .form-group input[type="text"],
        .form-group input[type="date"],
        .form-group input[type="file"] {
            width: 100%;
            padding: 0.7rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--neutral-medium);
        }

        .entry-modal-content .entry-content {
            -webkit-line-clamp: unset;
            overflow: visible;
            padding: 1rem 0;
            line-height: 1.8;
        }

        .entry-modal-content .entry-date {
            text-align: center;
            margin-bottom: 1rem;
            color: var(--neutral-dark);
        }

        .entry-modal-content .entry-actions {
            justify-content: center;
            gap: 1rem;
            border-top: none;
            padding: 1rem 0 0;
        }

        .favorite-btn.active i {
            color: gold;
        }

        /* Estilos para la vista de impresi√≥n */
        @media print {
            body * {
                visibility: hidden;
            }
            .print-section, .print-section * {
                visibility: visible;
            }
            .print-section {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 20px;
                background-color: white;
                color: black;
            }
            .no-print {
                display: none !important;
            }
            .print-title {
                text-align: center;
                margin-bottom: 2rem;
                font-size: 2rem;
                color: black;
            }
            .print-entry {
                margin-bottom: 2rem;
                page-break-inside: avoid;
            }
            .print-entry h3 {
                color: var(--primary-color);
                margin-bottom: 0.5rem;
            }
            .print-entry .date {
                color: #666;
                margin-bottom: 1rem;
            }
            .print-entry .content {
                line-height: 1.6;
            }
            .print-memory img {
                max-width: 100%;
                height: auto;
                margin-top: 1rem;
            }
        }

        /* Estilos para el popup de felicitaciones */
        .congrats-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.5s ease;
        }
        
        .congrats-content {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .congrats-content h2 {
            color: #fff;
            font-size: 2rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .congrats-content p {
            color: #fff;
            font-size: 1.2rem;
            margin-bottom: 2rem;
        }
        
        .download-book-btn {
            background-color: #fff;
            color: #ff6b6b;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .download-book-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        .download-book-btn:active {
            transform: translateY(1px);
        }
        
        /* Estilos para el confeti */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
            animation: confetti 5s ease-in-out infinite;
        }
        
        @keyframes confetti {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        /* Estilos para los modales de informaci√≥n */
        .info-modal {
            max-width: 500px;
        }
        
        .info-modal h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .info-modal p {
            margin-bottom: 1rem;
            line-height: 1.6;
        }
        
        .info-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .info-icon {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-right: 1rem;
            min-width: 30px;
        }
        
        .info-text {
            flex: 1;
        }
        
        .pwa-instruction {
            background-color: var(--neutral-light);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }
        
        .pwa-instruction h4 {
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        /* Estilos para el sistema de calificaci√≥n */
        .rating-container {
            margin-top: 3rem;
            padding: 2rem;
            background-color: var(--neutral-light);
            border-radius: var(--border-radius);
            text-align: center;
            display: none; /* Oculto por defecto, solo se muestra en la secci√≥n de preguntas */
        }

        .rating-container h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .rating-stars {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .rating-star {
            font-size: 2rem;
            color: var(--neutral-medium);
            cursor: pointer;
            transition: var(--transition);
        }

        .rating-star:hover,
        .rating-star.active {
            color: var(--warning-color);
        }

        .rating-feedback {
            width: 100%;
            padding: 1rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--neutral-medium);
            margin-bottom: 1rem;
            resize: vertical;
            min-height: 100px;
        }

        .send-rating-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin: 0 auto;
        }

        .send-rating-btn:hover {
            background-color: #218838;
        }

        /* Estilos para el mensaje de libro generado */
        .info-message {
            background-color: #f8f9fa;
            border-left: 4px solid #6a5acd;
            padding: 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .info-message i {
            color: #6a5acd;
            font-size: 1.2rem;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .app-header {
                padding: 1rem;
            }
            
            .nav-menu {
                flex-wrap: wrap;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .entries-grid, .questions-grid, .memories-grid, .favorites-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                padding: 1.5rem;
            }

            .welcome-container h2 {
                font-size: 1.5rem;
            }

            .welcome-container p {
                font-size: 1rem;
            }

            .parent-selector {
                position: static;
                margin-bottom: 1rem;
            }

            .export-buttons {
                position: static;
                justify-content: center;
                margin-bottom: 1rem;
            }

            .congrats-content h2 {
                font-size: 1.5rem;
            }
            
            .congrats-content p {
                font-size: 1rem;
            }
            
            .download-book-btn {
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
            }
            
            .question-categories {
                overflow-x: auto;
                padding-bottom: 0.5rem;
                justify-content: flex-start;
            }

            .rating-star {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .app-header h1 {
                font-size: 1.5rem;
            }
            
            .nav-btn {
                font-size: 0.9rem;
                padding: 0.5rem;
            }
            
            .welcome-container {
                padding: 1rem;
            }
            
            .section-header h2 {
                font-size: 1.3rem;
            }
            
            .auth-box {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Sistema de autenticaci√≥n -->
    <div class="auth-container" id="auth-container">
        <div class="auth-box">
            <div id="login-form">
                <h2>Iniciar Sesi√≥n</h2>
                <form class="auth-form" id="login-form-element">
                    <div class="form-group">
                        <label for="login-password">Contrase√±a</label>
                        <input type="password" id="login-password" required>
                    </div>
                    <button type="submit">Ingresar</button>
                </form>
                <p class="auth-toggle"><a id="show-register"></a></p>
            </div>
            
            <div id="register-form" style="display: none;">
                <h2>Crear Contrase√±a</h2>
                <form class="auth-form" id="register-form-element">
                    <div class="form-group">
                        <label for="register-password">Elige tu contrase√±a</label>
                        <input type="password" id="register-password" required>
                    </div>
                    <div class="form-group">
                        <label for="confirm-password">Confirma tu contrase√±a</label>
                        <input type="password" id="confirm-password" required>
                    </div>
                    <button type="submit">Guardar Contrase√±a</button>
                </form>
                <p class="auth-toggle">¬øYa tienes una contrase√±a? <a id="show-login">Iniciar sesi√≥n</a></p>
            </div>
        </div>
    </div>

    <!-- Aplicaci√≥n principal (oculta inicialmente) -->
    <div class="app-container theme-mama">
        <header class="app-header">
            <div class="parent-selector">
                <button class="parent-btn active" id="mama-btn"><i class="fas fa-female"></i> Mam√°</button>
                <button class="parent-btn" id="papa-btn" onclick="window.location.href='https://www.ejemplo.com/papa'"><i class="fas fa-globe"></i> Sitio Web</button>
            </div>
            <div class="logo-container">
                <img src="https://cuentame.estuwebapp.com.mx/apiv3/section/70149884/libro2cth.png" class="logo">
                <h1>Un regalo de amor</h1>
            </div>
            <nav class="nav-menu">
                <button class="nav-btn active" data-section="home"><i class="fas fa-home"></i> Inicio</button>
                <button class="nav-btn" data-section="questions"><i class="fas fa-book"></i> Mi Historia</button>
                <button class="nav-btn" data-section="cover"><i class="fas fa-book-open"></i> Crear Portada</button>
                <button class="nav-btn" data-section="favorites"><i class="fas fa-star"></i> Favoritos</button>
                <button class="nav-btn" id="info-btn"><i class="fas fa-info-circle"></i> Info</button>
                <button class="nav-btn" id="download-btn" style="display: none;"><i class="fas fa-download"></i> Descargar</button>
                <button class="nav-btn" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Salir</button>
            </nav>
        </header>

        <main class="main-content">
            <!-- Secci√≥n de Inicio -->
            <section id="home" class="content-section active">
                <div class="welcome-container">
                    <h2>¬°Bienvenido! üëã</h2>
                    <p>Comparte con tus hij@s y niet@s anecdotas, experiencias y reflexiones. üíñ</p>
                    
                    <div class="progress-container">
                        <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
                        <div class="progress-text" id="progress-text">0% completado</div>
                    </div>
                    
                    <div class="welcome-animation">
                        <div class="animation-circle"></div>
                        <div class="animation-circle"></div>
                        <div class="animation-circle"></div>
                    </div>
                    <button class="cta-button" id="start-journaling">Empezar a escribir ‚úçÔ∏è</button>
                </div>
                <div class="recent-entries">
                    <h3>Entradas recientes</h3>
                    <div class="entries-grid" id="recent-entries-grid">
                        <!-- Entradas recientes se cargar√°n aqu√≠ -->
                    </div>
                </div>
            </section>

            <!-- Secci√≥n de Preguntas (ahora contiene todas las subsecciones) -->
            <section id="questions" class="content-section">
                <div class="section-header">
                    <h2>Comparte tu historia üìñ</h2>
                    <p>Responde estas preguntas para que tu hij@ conozca con mayor detalle tu vida. üë∂‚û°Ô∏èüë®</p>
                    <div class="export-buttons">
                        <button class="export-btn" id="export-questions-pdf"><i class="fas fa-file-pdf"></i> Descargar libro</button>
                    </div>
                </div>
                
                <!-- Men√∫ de subsecciones -->
                <div class="question-categories">
                    <button class="category-btn active" data-category="all"><i class="fas fa-list"></i> Todas</button>
                    <button class="category-btn" data-category="infancia"><i class="fas fa-baby"></i> Ni√±ez</button>
                    <button class="category-btn" data-category="adolescencia"><i class="fas fa-user-graduate"></i> Adolescencia</button>
                    <button class="category-btn" data-category="familia"><i class="fas fa-home"></i> Familia</button>
                    <button class="category-btn" data-category="educacion"><i class="fas fa-graduation-cap"></i> Educaci√≥n</button>
                    <button class="category-btn" data-category="hobbies"><i class="fas fa-gamepad"></i> Hobbies</button>
                    <button class="category-btn" data-category="deporte"><i class="fas fa-running"></i> Deporte</button>
                    <button class="category-btn" data-category="musica"><i class="fas fa-music"></i> M√∫sica</button>
                    <button class="category-btn" data-category="amor"><i class="fas fa-heart"></i> Amor</button>
                    <button class="category-btn" data-category="trabajo"><i class="fas fa-briefcase"></i> Trabajo</button>
                    <button class="category-btn" data-category="viajes"><i class="fas fa-plane"></i> Viajes</button>
                    <button class="category-btn" data-category="consejos"><i class="fas fa-lightbulb"></i> Consejos</button>
                    <button class="category-btn" data-category="momentos"><i class="fas fa-heartbeat"></i> Momentos Dif√≠ciles</button>
                    <button class="category-btn" data-category="tecnologia"><i class="fas fa-laptop"></i> Tecnolog√≠a y √âpoca</button>
                    <button class="category-btn" data-category="sue√±os"><i class="fas fa-cloud"></i> Sue√±os y Metas</button>
                    <button class="category-btn" data-category="creencias"><i class="fas fa-hands-helping"></i> Creencias y Valores</button>
                    <button class="category-btn" data-category="mensajes"><i class="fas fa-envelope-open-text"></i> Mensajes Futuros</button>
                </div>
                
                <div class="questions-grid" id="questions-grid">
                    <!-- Preguntas se cargar√°n aqu√≠ -->
                </div>

                <!-- Sistema de calificaci√≥n -->
                <div class="rating-container" id="rating-container">
                    <h3>¬øC√≥mo calificar√≠as esta aplicaci√≥n?</h3>
                    <div class="rating-stars">
                        <i class="fas fa-star rating-star" data-rating="1"></i>
                        <i class="fas fa-star rating-star" data-rating="2"></i>
                        <i class="fas fa-star rating-star" data-rating="3"></i>
                        <i class="fas fa-star rating-star" data-rating="4"></i>
                        <i class="fas fa-star rating-star" data-rating="5"></i>
                    </div>
                    <textarea class="rating-feedback" placeholder="Danos tu opini√≥n o sugerencias..."></textarea>
                    <button class="send-rating-btn" id="send-rating-btn">
                        <i class="fas fa-paper-plane"></i> Enviar Calificaci√≥n
                    </button>
                </div>
            </section>

            <!-- Secci√≥n de Crear Portada -->
            <section id="cover" class="content-section">
                <div class="section-header">
                    <h2>Crea una portada personalizada para tu libro üìî</h2>
                    <p>Selecciona entre varios modelos de portada para darle un toque especial y √∫nico a tu historia. <br> NOTA: Esta portada se descarga por separado del libro.</p>
                </div>
                <div style="text-align: center; margin-top: 2rem;">
                    <a href="https://www.canva.com/design?category=tJfJXQljDnU" target="_blank" class="cta-button" style="font-size: 1.2rem; padding: 1rem 2rem;">
                        <i class="fas fa-paint-brush"></i> Dise√±ar portada
                    </a>
                </div>
            </section>

            <!-- Secci√≥n de Favoritos -->
            <section id="favorites" class="content-section">
                <div class="section-header">
                    <h2>Tus entradas favoritas ‚≠ê</h2>
                    <p>Todas las entradas que has marcado como favoritas aparecer√°n aqu√≠. ‚ú®</p>
                    <div class="export-buttons">
                        <button class="export-btn" id="export-favorites-pdf"><i class="fas fa-file-pdf"></i> PDF</button>
                    </div>
                </div>
                <div class="favorites-grid" id="favorites-grid">
                    <!-- Favoritos se cargar√°n aqu√≠ -->
                </div>
            </section>
        </main>

        <!-- Modal para responder preguntas -->
        <div class="modal" id="question-modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3 id="modal-question-title"></h3>
                <textarea id="modal-question-answer" placeholder="Escribe tu respuesta aqu√≠... ‚úçÔ∏è"></textarea>
                <div class="modal-actions">
                    <button class="modal-btn save-btn"><i class="fas fa-save"></i> Guardar</button>
                    <button class="modal-btn cancel-btn"><i class="fas fa-times"></i> Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Modal para a√±adir recuerdos -->
        <div class="modal" id="memory-modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>A√±adir nuevo recuerdo üì∏</h3>
                <div class="memory-form">
                    <div class="form-group">
                        <label for="memory-title">T√≠tulo:</label>
                        <input type="text" id="memory-title" placeholder="Ej: Primer d√≠a de escuela">
                    </div>
                    <div class="form-group">
                        <label for="memory-date">Fecha:</label>
                        <input type="date" id="memory-date">
                    </div>
                    <div class="form-group">
                        <label for="memory-description">Descripci√≥n:</label>
                        <textarea id="memory-description" placeholder="Describe este recuerdo especial... ‚ú®"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="memory-media">A√±adir foto/video:</label>
                        <input type="file" id="memory-media" accept="image/*, video/*">
                    </div>
                    <div class="form-actions">
                        <button class="modal-btn save-btn" id="save-memory"><i class="fas fa-save"></i> Guardar Recuerdo</button>
                        <button class="modal-btn cancel-btn"><i class="fas fa-times"></i> Cancelar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para ver entradas completas -->
        <div class="modal" id="entry-modal">
            <div class="modal-content entry-modal-content">
                <span class="close-modal">&times;</span>
                <h3 id="entry-modal-title"></h3>
                <p class="entry-date" id="entry-modal-date"></p>
                <div class="entry-content" id="entry-modal-content"></div>
                <div class="entry-actions">
                    <button class="modal-btn edit-btn" id="edit-entry"><i class="fas fa-edit"></i> Editar</button>
                    <button class="modal-btn favorite-btn" id="toggle-favorite"><i class="far fa-star"></i> Favorito</button>
                    <button class="modal-btn close-btn"><i class="fas fa-times"></i> Cerrar</button>
                </div>
            </div>
        </div>

        <!-- Popup de felicitaciones -->
        <div class="congrats-popup" id="congrats-popup" style="display: none;">
            <div class="congrats-content">
                <h2>¬°Felicidades! üéâ</h2>
                <p>¬°Has completado todas las preguntas de tu diario! Ahora puedes descargar todo el libro para guardarlo, imprimirlo y compartirlo con tu hij@.</p>
                <button class="download-book-btn" id="download-book-btn">
                    <i class="fas fa-download"></i> Descargar Todo el Libro
                </button>
            </div>
            <!-- Confeti se generar√° aqu√≠ din√°micamente -->
        </div>

        <!-- Modal de informaci√≥n -->
        <div class="modal" id="info-modal">
            <div class="modal-content info-modal">
                <span class="close-modal">&times;</span>
                <h3>¬øC√≥mo usar esta aplicaci√≥n?</h3>
                
                <div class="info-step">
                    <div class="info-icon"><i class="fas fa-book"></i></div>
                    <div class="info-text">
                        <h4>1. Responde preguntas</h4>
                        <p>En la secci√≥n "Mi Historia" encontrar√°s preguntas organizadas por categor√≠as.</p>
                    </div>
                </div>
                
                <div class="info-step">
                    <div class="info-icon"><i class="fas fa-star"></i></div>
                    <div class="info-text">
                        <h4>2. Marca favoritos</h4>
                        <p>Puedes marcar tus entradas favoritas para encontrarlas f√°cilmente en la secci√≥n "Favoritos".</p>
                    </div>
                </div>
                
                <div class="info-step">
                    <div class="info-icon"><i class="fas fa-paint-brush"></i></div>
                    <div class="info-text">
                        <h4>3. Personaliza tu libro</h4>
                        <p>Crea una portada √∫nica para tu libro usando la herramienta de dise√±o de Cu√©ntame tu historia.</p>
                    </div>
                </div>
                
                <div class="info-step">
                    <div class="info-icon"><i class="fas fa-download"></i></div>
                    <div class="info-text">
                        <h4>4. Exporta tu historia</h4>
                        <p>Puedes exportar tu libro en PDF o imprimirlo para guardarlo como un libro f√≠sico.</p>
                    </div>
                </div>
                
                <div class="info-step">
                    <div class="info-icon"><i class="fas fa-lock"></i></div>
                    <div class="info-text">
                        <h4>5. Tus datos son privados</h4>
                        <p>Toda la informaci√≥n que ingreses se guarda solo en tu dispositivo. Por tal raz√≥n nunca vemos tu informaci√≥n, es importante entender que el libro vive ahora en tu dispositivo √∫nicamente, nosotros no tendr√©mos respaldo.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de descarga PWA -->
        <div class="modal" id="download-modal">
            <div class="modal-content info-modal">
                <span class="close-modal">&times;</span>
                <h3>Instalar en tu celular</h3>
                <p>Puedes instalar esta aplicaci√≥n en tu celular como una PWA (Aplicaci√≥n Web Progresiva) para acceder a ella como una app nativa.</p>
                
                <div class="pwa-instruction">
                    <h4><i class="fab fa-android"></i> Para Android:</h4>
                    <ol>
                        <li>Abre la aplicaci√≥n en Chrome</li>
                        <li>Toca el men√∫ (tres puntos en la esquina superior derecha)</li>
                        <li>Selecciona "Instalar aplicaci√≥n" o "Agregar a la pantalla de inicio"</li>
                        <li>Confirma la instalaci√≥n</li>
                    </ol>
                </div>
                
                <div class="pwa-instruction">
                    <h4><i class="fab fa-apple"></i> Para iPhone:</h4>
                    <ol>
                        <li>Abre la aplicaci√≥n en Safari</li>
                        <li>Toca el √≠cono de compartir (cuadrado con flecha hacia arriba en tu men√∫ del celular)</li>
                        <li>Selecciona "Agregar a inicio"</li>
                        <li>Confirma la acci√≥n</li>
                    </ol>
                </div>
                
                <p>Una vez instalada, la aplicaci√≥n funcionar√° sin conexi√≥n a internet y tendr√° su propio √≠cono en la pantalla de inicio.</p>
            </div>
        </div>

        <!-- Contenedor oculto para impresi√≥n -->
        <div id="print-container" style="display: none;"></div>
    </div>

    <script>
        // Configurar jsPDF
        const { jsPDF } = window.jspdf;
        
        document.addEventListener('DOMContentLoaded', function() {
            // Variables globales
            let entries = JSON.parse(localStorage.getItem('diaryEntries')) || [];
            let memories = JSON.parse(localStorage.getItem('memories')) || [];
            let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
            let currentUser = null;
            
            // ARRAY DE CONTRASE√ëAS V√ÅLIDAS
            const VALID_PASSWORDS = [
                "miContrase√±aSegura123", 
                "password123",
                "diarioParaMiHijo",
                "familia2023"
            ];
            
            // Elementos del DOM
            const authContainer = document.getElementById('auth-container');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const showRegisterBtn = document.getElementById('show-register');
            const showLoginBtn = document.getElementById('show-login');
            const loginFormElement = document.getElementById('login-form-element');
            const registerFormElement = document.getElementById('register-form-element');
            const logoutBtn = document.getElementById('logout-btn');
            
            const appContainer = document.querySelector('.app-container');
            const appHeader = document.querySelector('.app-header');
            const mainContent = document.querySelector('.main-content');
            
            const navButtons = document.querySelectorAll('.nav-btn');
            const contentSections = document.querySelectorAll('.content-section');
            const startJournalingBtn = document.getElementById('start-journaling');
            const recentEntriesGrid = document.getElementById('recent-entries-grid');
            const questionsGrid = document.getElementById('questions-grid');
            const memoriesGrid = document.getElementById('memories-grid');
            const favoritesGrid = document.getElementById('favorites-grid');
            const questionModal = document.getElementById('question-modal');
            const memoryModal = document.getElementById('memory-modal');
            const entryModal = document.getElementById('entry-modal');
            const infoModal = document.getElementById('info-modal');
            const downloadModal = document.getElementById('download-modal');
            const infoBtn = document.getElementById('info-btn');
            const downloadBtn = document.getElementById('download-btn');
            const closeModalButtons = document.querySelectorAll('.close-modal');
            const modalQuestionTitle = document.getElementById('modal-question-title');
            const modalQuestionAnswer = document.getElementById('modal-question-answer');
            const saveQuestionBtn = document.querySelector('.save-btn');
            const addMemoryBtn = document.getElementById('add-memory');
            const saveMemoryBtn = document.getElementById('save-memory');
            const toggleFavoriteBtn = document.getElementById('toggle-favorite');
            const editEntryBtn = document.getElementById('edit-entry');
            const entryModalTitle = document.getElementById('entry-modal-title');
            const entryModalDate = document.getElementById('entry-modal-date');
            const entryModalContent = document.getElementById('entry-modal-content');
            const categoryButtons = document.querySelectorAll('.category-btn');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const mamaBtn = document.getElementById('mama-btn');
            const papaBtn = document.getElementById('papa-btn');
            const printContainer = document.getElementById('print-container');
            const congratsPopup = document.getElementById('congrats-popup');
            const downloadBookBtn = document.getElementById('download-book-btn');
            const ratingContainer = document.getElementById('rating-container');
            const ratingStars = document.querySelectorAll('.rating-star');
            const ratingFeedback = document.querySelector('.rating-feedback');
            const sendRatingBtn = document.getElementById('send-rating-btn');
            
            // Botones de exportaci√≥n
            const exportQuestionsPdfBtn = document.getElementById('export-questions-pdf');
            const exportFavoritesPdfBtn = document.getElementById('export-favorites-pdf');
            
            // Preguntas organizadas por categor√≠as
            const questions = [
                // Ni√±ez (Infancia)
                { id: 1, text: "¬øCu√°l es tu primer recuerdo de la infancia?", category: "infancia", icon: "fa-baby" },
                { id: 2, text: "¬øC√≥mo describir√≠as tu personalidad de ni√±o?", category: "infancia", icon: "fa-child" },
                { id: 3, text: "¬øCu√°l era tu juguete favorito y por qu√©?", category: "infancia", icon: "fa-cube" },
                { id: 4, text: "¬øQu√© actividades disfrutabas hacer en tu tiempo libre?", category: "infancia", icon: "fa-puzzle-piece" },
                { id: 5, text: "¬øC√≥mo era un d√≠a t√≠pico en tu infancia?", category: "infancia", icon: "fa-sun" },
                { id: 6, text: "¬øQu√© te asustaba cuando eras ni√±o?", category: "infancia", icon: "fa-ghost" },
                { id: 7, text: "¬øCu√°l era tu comida favorita y por qu√©?", category: "infancia", icon: "fa-ice-cream" },
                { id: 8, text: "¬øQu√© personaje de televisi√≥n o pel√≠cula admirabas?", category: "infancia", icon: "fa-tv" },
                { id: 9, text: "¬øQu√© quer√≠as ser de mayor cuando eras ni√±o?", category: "infancia", icon: "fa-user-astronaut" },
                { id: 10, text: "¬øQu√© consejo le dar√≠as a tu yo ni√±o?", category: "infancia", icon: "fa-comment-dots" },

                // Adolescencia
                { id: 11, text: "¬øC√≥mo era tu grupo de amigos en la adolescencia?", category: "adolescencia", icon: "fa-users" },
                { id: 12, text: "Describe tu primera vez conduciendo o en moto", category: "adolescencia", icon: "fa-car" },
                { id: 13, text: "¬øQu√© m√∫sica escuchabas en tu juventud?", category: "adolescencia", icon: "fa-music" },
                { id: 14, text: "Cu√©ntame sobre tu primer amor", category: "adolescencia", icon: "fa-heart" },
                { id: 15, text: "¬øC√≥mo era tu estilo de vestir en la adolescencia?", category: "adolescencia", icon: "fa-tshirt" },
                { id: 16, text: "Describe tu primera experiencia laboral", category: "adolescencia", icon: "fa-briefcase" },
                { id: 17, text: "¬øA qu√© lugares sal√≠as con tus amigos?", category: "adolescencia", icon: "fa-map-marker-alt" },
                { id: 18, text: "Cu√©ntame sobre tu fiesta de graduaci√≥n", category: "adolescencia", icon: "fa-graduation-cap" },
                { id: 19, text: "¬øQu√© sue√±os ten√≠as para tu futuro a los 18 a√±os?", category: "adolescencia", icon: "fa-star" },
                { id: 20, text: "¬øC√≥mo imaginabas que ser√≠a tu vida adulta?", category: "adolescencia", icon: "fa-chart-line" },

                // Familia
                { id: 21, text: "¬øC√≥mo se llamaban tus padres y c√≥mo eran?", category: "familia", icon: "fa-home" },
                { id: 22, text: "¬øTienes hermanos? Describe tu relaci√≥n con ellos", category: "familia", icon: "fa-user-friends" },
                { id: 23, text: "¬øC√≥mo era la casa donde creciste?", category: "familia", icon: "fa-house-user" },
                { id: 24, text: "¬øQu√© tradiciones familiares recuerdas con cari√±o?", category: "familia", icon: "fa-hands-helping" },
                { id: 25, text: "¬øQu√© valores importantes te ense√±√≥ tu familia?", category: "familia", icon: "fa-heart" },
                { id: 26, text: "¬øC√≥mo se conocieron tus padres?", category: "familia", icon: "fa-ring" },
                { id: 27, text: "¬øQu√© recuerdos tienes de tus abuelos?", category: "familia", icon: "fa-user-tie" },
                { id: 28, text: "¬øQu√© historias familiares se contaban generaci√≥n tras generaci√≥n?", category: "familia", icon: "fa-book-open" },
                { id: 29, text: "¬øQu√© recetas familiares te gustar√≠a pasar a tu hijo?", category: "familia", icon: "fa-utensils" },
                { id: 30, text: "¬øQu√© le dir√≠as a tus antepasados si pudieras hablar con ellos?", category: "familia", icon: "fa-comments" },

                // Educaci√≥n
                { id: 31, text: "¬øC√≥mo se llamaba tu primera escuela y c√≥mo era?", category: "educacion", icon: "fa-school" },
                { id: 32, text: "Describe a tu primer maestro o maestra", category: "educacion", icon: "fa-chalkboard-teacher" },
                { id: 33, text: "¬øQu√© asignatura se te daba mejor y cu√°l peor?", category: "educacion", icon: "fa-book" },
                { id: 34, text: "Cu√©ntame sobre tus amigos del colegio", category: "educacion", icon: "fa-user-graduate" },
                { id: 35, text: "¬øQu√© actividades extracurriculares hac√≠as?", category: "educacion", icon: "fa-paint-brush" },
                { id: 36, text: "Describe tu primer d√≠a de escuela", category: "educacion", icon: "fa-calendar-day" },
                { id: 37, text: "¬øQu√© recuerdas de los recreos?", category: "educacion", icon: "fa-running" },
                { id: 38, text: "¬øTuviste alg√∫n profesor que marc√≥ tu vida?", category: "educacion", icon: "fa-user-graduate" },
                { id: 39, text: "Cu√©ntame sobre tu graduaci√≥n de primaria/secundaria", category: "educacion", icon: "fa-graduation-cap" },
                { id: 40, text: "¬øQu√© aprendizaje escolar te ha sido m√°s √∫til en la vida?", category: "educacion", icon: "fa-lightbulb" },

                // Hobbies
                { id: 41, text: "¬øQu√© hobbies ten√≠as cuando eras ni√±o?", category: "hobbies", icon: "fa-gamepad" },
                { id: 42, text: "¬øQu√© juegos jugabas con tus amigos?", category: "hobbies", icon: "fa-dice" },
                { id: 43, text: "¬øQu√© libros le√≠as en tu tiempo libre?", category: "hobbies", icon: "fa-book-open" },
                { id: 44, text: "¬øQu√© programas de TV o pel√≠culas te gustaban?", category: "hobbies", icon: "fa-tv" },
                { id: 45, text: "¬øTen√≠as alguna colecci√≥n (estampas, figuras, etc.)?", category: "hobbies", icon: "fa-chess" },
                { id: 46, text: "¬øQu√© actividades creativas disfrutabas?", category: "hobbies", icon: "fa-paint-brush" },
                { id: 47, text: "¬øQu√© deportes o actividades f√≠sicas practicabas?", category: "hobbies", icon: "fa-running" },
                { id: 48, text: "¬øQu√© videojuegos jugabas?", category: "hobbies", icon: "fa-gamepad" },
                { id: 49, text: "¬øQu√© actividades al aire libre disfrutabas?", category: "hobbies", icon: "fa-tree" },
                { id: 50, text: "¬øQu√© hobby te gustar√≠a compartir con tu hijo?", category: "hobbies", icon: "fa-heart" },

                // Deporte
                { id: 51, text: "¬øPracticabas alg√∫n deporte en la escuela?", category: "deporte", icon: "fa-basketball-ball" },
                { id: 52, text: "¬øCu√°l era tu equipo deportivo favorito?", category: "deporte", icon: "fa-tshirt" },
                { id: 53, text: "Describe tu mejor recuerdo deportivo", category: "deporte", icon: "fa-trophy" },
                { id: 54, text: "¬øQu√© logros deportivos tuviste?", category: "deporte", icon: "fa-medal" },
                { id: 55, text: "¬øQu√© deporte te gustar√≠a ense√±arle a tu hijo?", category: "deporte", icon: "fa-running" },
                { id: 56, text: "¬øQu√© valores aprendiste del deporte?", category: "deporte", icon: "fa-heart" },
                { id: 57, text: "¬øQu√© partido o evento deportivo recuerdas con m√°s emoci√≥n?", category: "deporte", icon: "fa-volleyball-ball" },
                { id: 58, text: "¬øQu√© actividad f√≠sica disfrutas ahora?", category: "deporte", icon: "fa-biking" },
                { id: 59, text: "¬øQu√© consejo dar√≠as sobre la importancia del deporte?", category: "deporte", icon: "fa-comment" },
                { id: 60, text: "¬øC√≥mo te sent√≠as al competir o jugar?", category: "deporte", icon: "fa-smile" },

                // M√∫sica
                { id: 61, text: "¬øQu√© m√∫sica escuchabas en tu adolescencia?", category: "musica", icon: "fa-music" },
                { id: 62, text: "¬øCu√°l era tu canci√≥n favorita y por qu√©?", category: "musica", icon: "fa-compact-disc" },
                { id: 63, text: "¬øTocabas alg√∫n instrumento musical?", category: "musica", icon: "fa-guitar" },
                { id: 64, text: "¬øQu√© conciertos o eventos musicales recuerdas?", category: "musica", icon: "fa-microphone-alt" },
                { id: 65, text: "¬øQu√© artista o grupo admirabas?", category: "musica", icon: "fa-user-music" },
                { id: 66, text: "¬øQu√© canci√≥n te trae los mejores recuerdos?", category: "musica", icon: "fa-headphones" },
                { id: 67, text: "¬øQu√© m√∫sica te gustar√≠a compartir con tu hijo?", category: "musica", icon: "fa-heart" },
                { id: 68, text: "¬øC√≥mo influy√≥ la m√∫sica en tu vida?", category: "musica", icon: "fa-heartbeat" },
                { id: 69, text: "¬øQu√© canci√≥n describe mejor tu juventud?", category: "musica", icon: "fa-music" },
                { id: 70, text: "¬øQu√© g√©nero musical te gusta ahora?", category: "musica", icon: "fa-compact-disc" },

                // Amor
                { id: 71, text: "Describe tu primer amor", category: "amor", icon: "fa-heart" },
                { id: 72, text: "¬øC√≥mo conociste a tu pareja?", category: "amor", icon: "fa-user-friends" },
                { id: 73, text: "¬øQu√© cualidad valoras m√°s en una pareja?", category: "amor", icon: "fa-star" },
                { id: 74, text: "¬øQu√© has aprendido sobre el amor?", category: "amor", icon: "fa-lightbulb" },
                { id: 75, text: "Describe tu primera cita", category: "amor", icon: "fa-calendar-heart" },
                { id: 76, text: "¬øQu√© consejo dar√≠as sobre relaciones?", category: "amor", icon: "fa-comment" },
                { id: 77, text: "¬øC√≥mo ha cambiado tu idea del amor con los a√±os?", category: "amor", icon: "fa-heartbeat" },
                { id: 78, text: "¬øQu√© significa para ti el amor incondicional?", category: "amor", icon: "fa-heart" },
                { id: 79, text: "¬øQu√© momento rom√°ntico recuerdas con m√°s cari√±o?", category: "amor", icon: "fa-kiss-wink-heart" },
                { id: 80, text: "¬øQu√© lecci√≥n sobre el amor te cost√≥ m√°s aprender?", category: "amor", icon: "fa-graduation-cap" },

                // Trabajo
                { id: 81, text: "¬øCu√°l fue tu primer trabajo?", category: "trabajo", icon: "fa-briefcase" },
                { id: 82, text: "¬øC√≥mo elegiste tu carrera profesional?", category: "trabajo", icon: "fa-user-tie" },
                { id: 83, text: "¬øQu√© desaf√≠os laborales superaste con orgullo?", category: "trabajo", icon: "fa-trophy" },
                { id: 84, text: "¬øQu√© consejo dar√≠as sobre elegir una carrera?", category: "trabajo", icon: "fa-comment" },
                { id: 85, text: "¬øC√≥mo manejas el equilibrio entre trabajo y familia?", category: "trabajo", icon: "fa-balance-scale" },
                { id: 86, text: "¬øQu√© error laboral te ense√±√≥ una lecci√≥n valiosa?", category: "trabajo", icon: "fa-lightbulb" },
                { id: 87, text: "¬øQu√© logro profesional te enorgullece m√°s?", category: "trabajo", icon: "fa-medal" },
                { id: 88, text: "¬øC√≥mo defines el √©xito profesional ahora?", category: "trabajo", icon: "fa-chart-line" },
                { id: 89, text: "¬øQu√© habilidades laborales consideras m√°s importantes?", category: "trabajo", icon: "fa-cogs" },
                { id: 90, text: "¬øQu√© consejo dar√≠as sobre manejar el dinero?", category: "trabajo", icon: "fa-money-bill-wave" },

                // Viajes
                { id: 91, text: "¬øCu√°l fue tu primer viaje importante?", category: "viajes", icon: "fa-plane" },
                { id: 92, text: "Describe tu lugar favorito en el mundo", category: "viajes", icon: "fa-map-marked-alt" },
                { id: 93, text: "¬øQu√© cultura te gustar√≠a explorar m√°s?", category: "viajes", icon: "fa-globe-europe" },
                { id: 94, text: "¬øQu√© experiencia de viaje te cambi√≥?", category: "viajes", icon: "fa-lightbulb" },
                { id: 95, text: "¬øQu√© lugar te hace sentir en casa?", category: "viajes", icon: "fa-home" },
                { id: 96, text: "¬øQu√© destino recomendar√≠as a tu hijo?", category: "viajes", icon: "fa-map" },
                { id: 97, text: "¬øQu√© comida extranjera te encanta?", category: "viajes", icon: "fa-utensils" },
                { id: 98, text: "¬øQu√© idioma te gustar√≠a aprender?", category: "viajes", icon: "fa-language" },
                { id: 99, text: "¬øQu√© tradici√≥n cultural admiras?", category: "viajes", icon: "fa-monument" },
                { id: 100, text: "¬øQu√© lugar te gustar√≠a mostrarle a tu hijo?", category: "viajes", icon: "fa-child" },

                // Consejos
                { id: 101, text: "¬øQu√© consejo le dar√≠as a tu hijo sobre la familia?", category: "consejos", icon: "fa-home" },
                { id: 102, text: "¬øQu√© has aprendido sobre el amor que quieres transmitir?", category: "consejos", icon: "fa-heart" },
                { id: 103, text: "¬øQu√© errores cometiste que no quieres que repita?", category: "consejos", icon: "fa-exclamation-triangle" },
                { id: 104, text: "¬øC√≥mo manejas las dificultades y qu√© le recomendar√≠as?", category: "consejos", icon: "fa-hands-helping" },
                { id: 105, text: "¬øQu√© le dir√≠as sobre elegir amigos?", category: "consejos", icon: "fa-user-friends" },
                { id: 106, text: "¬øQu√© consejo le dar√≠as sobre estudios y profesi√≥n?", category: "consejos", icon: "fa-graduation-cap" },
                { id: 107, text: "¬øC√≥mo debe manejar el dinero seg√∫n tu experiencia?", category: "consejos", icon: "fa-money-bill-wave" },
                { id: 108, text: "¬øQu√© has aprendido sobre la salud que es importante?", category: "consejos", icon: "fa-heartbeat" },
                { id: 109, text: "¬øQu√© valores consideras m√°s importantes en la vida?", category: "consejos", icon: "fa-star" },
                { id: 110, text: "Si solo pudieras transmitir una lecci√≥n a tu hijo, ¬øcu√°l ser√≠a?", category: "consejos", icon: "fa-lightbulb" },

                // Momentos Dif√≠ciles
                { id: 111, text: "¬øCu√°l fue el momento m√°s dif√≠cil de tu vida y c√≥mo lo superaste?", category: "momentos", icon: "fa-heartbeat" },
                { id: 112, text: "¬øQu√© p√©rdida te marc√≥ profundamente?", category: "momentos", icon: "fa-hand-holding-heart" },
                { id: 113, text: "¬øQu√© obst√°culo te pareci√≥ imposible pero lograste vencer?", category: "momentos", icon: "fa-dumbbell" },
                { id: 114, text: "¬øQui√©n te ayud√≥ en tus momentos m√°s oscuros?", category: "momentos", icon: "fa-handshake" },

                // Tecnolog√≠a y √âpoca
                { id: 115, text: "¬øC√≥mo era la tecnolog√≠a cuando eras joven?", category: "tecnologia", icon: "fa-mobile-alt" },
                { id: 116, text: "¬øA qu√© jugabas antes de los smartphones?", category: "tecnologia", icon: "fa-gamepad" },
                { id: 117, text: "¬øC√≥mo te comunicabas con tus amigos sin redes sociales?", category: "tecnologia", icon: "fa-tv" },
                { id: 118, text: "¬øQu√© avance tecnol√≥gico te ha sorprendido m√°s?", category: "tecnologia", icon: "fa-robot" },

                // Sue√±os y Metas
                { id: 119, text: "¬øCu√°l era tu mayor sue√±o de ni√±o?", category: "sue√±os", icon: "fa-star" },
                { id: 120, text: "¬øQu√© meta te cost√≥ m√°s trabajo alcanzar?", category: "sue√±os", icon: "fa-bullseye" },
                { id: 121, text: "¬øQu√© sue√±o tienes a√∫n por cumplir?", category: "sue√±os", icon: "fa-cloud" },
                { id: 122, text: "¬øQu√© sue√±os tienes para tu hijo?", category: "sue√±os", icon: "fa-hand-holding-heart" },

                // Creencias y Valores
                { id: 123, text: "¬øQu√© valores son los m√°s importantes para ti?", category: "creencias", icon: "fa-hands-helping" },
                { id: 124, text: "¬øC√≥mo influyeron tus creencias en tus decisiones?", category: "creencias", icon: "fa-praying-hands" },
                { id: 125, text: "¬øQu√© lecci√≥n moral te gustar√≠a transmitir?", category: "creencias", icon: "fa-heart" },
                { id: 126, text: "¬øC√≥mo defines lo que est√° bien y lo que est√° mal?", category: "creencias", icon: "fa-balance-scale" },

                // Mensajes Futuros
                { id: 127, text: "¬øQu√© mensaje te gustar√≠a que tu hijo leyera en 20 a√±os?", category: "mensajes", icon: "fa-envelope-open-text" },
                { id: 128, text: "¬øQu√© consejo le dar√≠as para cuando sea adulto?", category: "mensajes", icon: "fa-graduation-cap" },
                { id: 129, text: "¬øQu√© quieres que nunca olvide?", category: "mensajes", icon: "fa-heart" },
                { id: 130, text: "¬øC√≥mo quieres que te recuerde?", category: "mensajes", icon: "fa-child" }
            ];
            
            // Variables para el estado actual
            let currentQuestion = null;
            let currentEntry = null;
            let isEditing = false;
            let selectedRating = 0;
            
            // Inicializar la aplicaci√≥n
            initApp();
            
            // Funci√≥n de inicializaci√≥n
            function initApp() {
                setupEventListeners();
                
                // Verificar si hay un usuario logueado
                const loggedIn = localStorage.getItem('loggedIn');
                if (loggedIn === 'true') {
                    loadUserData();
                    showApp();
                    
                    // Verificar si el libro ya fue generado
                    if (isBookGenerated()) {
                        showBookGeneratedMessage();
                    }
                } else {
                    showAuth();
                }
            }
            
            // Mostrar mensaje de libro generado
            function showBookGeneratedMessage() {
                const infoSection = document.createElement('div');
                infoSection.className = 'info-message';
                infoSection.innerHTML = `
                    <i class="fas fa-info-circle"></i>
                    <p>El libro ya ha sido generado. Las respuestas no pueden ser editadas.</p>
                `;
                document.querySelector('.main-content').prepend(infoSection);
            }
            
            // Verificar si el libro ha sido generado
            function isBookGenerated() {
                return localStorage.getItem('bookGenerated') === 'true';
            }
            
            // Mostrar la aplicaci√≥n (oculta la autenticaci√≥n)
            function showApp() {
                authContainer.style.display = 'none';
                appHeader.style.display = 'flex';
                mainContent.style.display = 'block';
                
                loadRecentEntries();
                loadQuestions();
                loadFavorites();
                updateProgressBar();
                
                // Establecer fecha predeterminada para nuevos recuerdos
                document.getElementById('memory-date').valueAsDate = new Date();
                
                // Cargar tema guardado o usar el predeterminado (mam√°)
                const savedTheme = localStorage.getItem('parentTheme') || 'mama';
                setTheme(savedTheme);
            }
            
            // Mostrar la autenticaci√≥n (oculta la aplicaci√≥n)
            function showAuth() {
                authContainer.style.display = 'flex';
                appHeader.style.display = 'none';
                mainContent.style.display = 'none';
            }
            
            // Cargar datos del usuario
            function loadUserData() {
                entries = JSON.parse(localStorage.getItem('diaryEntries')) || [];
                favorites = JSON.parse(localStorage.getItem('favorites')) || [];
                memories = JSON.parse(localStorage.getItem('memories')) || [];
            }
            
            // Guardar datos del usuario
            function saveUserData() {
                localStorage.setItem('diaryEntries', JSON.stringify(entries));
                localStorage.setItem('favorites', JSON.stringify(favorites));
                localStorage.setItem('memories', JSON.stringify(memories));
            }
            
            // Configurar event listeners
            function setupEventListeners() {
                // Autenticaci√≥n
                showRegisterBtn.addEventListener('click', () => {
                    loginForm.style.display = 'none';
                    registerForm.style.display = 'block';
                });
                
                showLoginBtn.addEventListener('click', () => {
                    registerForm.style.display = 'none';
                    loginForm.style.display = 'block';
                });
                
                loginFormElement.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const password = document.getElementById('login-password').value;
                    
                    // Validar contra el array de contrase√±as
                    if (VALID_PASSWORDS.includes(password)) {
                        localStorage.setItem('loggedIn', 'true');
                        loadUserData();
                        showApp();
                    } else {
                        alert('Contrase√±a incorrecta');
                    }
                });
                
                registerFormElement.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const password = document.getElementById('register-password').value;
                    const confirmPassword = document.getElementById('confirm-password').value;
                    
                    if (password !== confirmPassword) {
                        alert('Las contrase√±as no coinciden');
                        return;
                    }
                    
                    // Validar contra el array de contrase√±as
                    if (VALID_PASSWORDS.includes(password)) {
                        localStorage.setItem('loggedIn', 'true');
                        loadUserData();
                        showApp();
                    } else {
                        alert('La contrase√±a no es v√°lida');
                    }
                });
                
                logoutBtn.addEventListener('click', () => {
                    localStorage.removeItem('loggedIn');
                    showAuth();
                });
                
                // Navegaci√≥n
                navButtons.forEach(button => {
                    if (button.id !== 'logout-btn' && button.id !== 'info-btn' && button.id !== 'download-btn') {
                        button.addEventListener('click', () => {
                            const sectionId = button.getAttribute('data-section');
                            switchSection(sectionId);
                        });
                    }
                });
                
                // Bot√≥n de informaci√≥n
                infoBtn.addEventListener('click', () => {
                    infoModal.style.display = 'flex';
                });
                
                // Bot√≥n de descarga PWA
                downloadBtn.addEventListener('click', () => {
                    downloadModal.style.display = 'flex';
                });
                
                // Bot√≥n de empezar a escribir
                startJournalingBtn.addEventListener('click', () => {
                    switchSection('questions');
                });
                
                // Cerrar modales
                closeModalButtons.forEach(button => {
                    button.addEventListener('click', closeAllModals);
                });
                
                // Guardar respuesta a pregunta
                saveQuestionBtn.addEventListener('click', saveQuestionAnswer);
                
                // Alternar favorito
                toggleFavoriteBtn.addEventListener('click', toggleFavorite);
                
                // Editar entrada
                editEntryBtn.addEventListener('click', editEntry);
                
                // Filtrar preguntas por categor√≠a
                categoryButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const category = button.getAttribute('data-category');
                        filterQuestionsByCategory(category);
                        
                        // Actualizar botones activos
                        categoryButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                    });
                });
                
                // Cerrar modal al hacer clic fuera del contenido
                window.addEventListener('click', (event) => {
                    if (event.target.classList.contains('modal')) {
                        closeAllModals();
                    }
                });
                
                // Selecci√≥n de padre/madre
                mamaBtn.addEventListener('click', () => setTheme('mama'));
                // El bot√≥n de pap√° ahora tiene un enlace directo en el HTML
                
                // Botones de exportaci√≥n
                exportQuestionsPdfBtn.addEventListener('click', () => exportSectionToPdf('questions'));
                exportFavoritesPdfBtn.addEventListener('click', () => exportSectionToPdf('favorites'));
                
                // Bot√≥n para descargar libro completo
                downloadBookBtn.addEventListener('click', downloadCompleteBook);

                // Sistema de calificaci√≥n
                ratingStars.forEach(star => {
                    star.addEventListener('click', () => {
                        const rating = parseInt(star.getAttribute('data-rating'));
                        setRating(rating);
                    });

                    star.addEventListener('mouseover', () => {
                        const rating = parseInt(star.getAttribute('data-rating'));
                        highlightStars(rating);
                    });

                    star.addEventListener('mouseout', () => {
                        highlightStars(selectedRating);
                    });
                });

                sendRatingBtn.addEventListener('click', sendRating);
            }
            
            // Cambiar tema entre mam√° y pap√°
            function setTheme(theme) {
                // Remover clases de tema existentes
                appContainer.classList.remove('theme-mama', 'theme-papa');
                
                // A√±adir nueva clase de tema
                appContainer.classList.add(`theme-${theme}`);
                
                // Actualizar botones activos
                mamaBtn.classList.toggle('active', theme === 'mama');
                papaBtn.classList.toggle('active', theme === 'papa');
                
                // Guardar preferencia
                localStorage.setItem('parentTheme', theme);
            }
            
            // Actualizar barra de progreso
            function updateProgressBar() {
                const totalEntries = entries.length;
                const totalQuestions = questions.length;
                const progressPercentage = Math.min(Math.round((totalEntries / totalQuestions) * 100), 100);
                
                progressBar.style.width = `${progressPercentage}%`;
                progressText.textContent = `${progressPercentage}% completado (${totalEntries}/${totalQuestions})`;
                
                // Ajustar color del texto seg√∫n el porcentaje
                if (progressPercentage > 50) {
                    progressText.style.color = 'white';
                } else {
                    progressText.style.color = 'var(--dark-color)';
                }
                
                // Mostrar/ocultar bot√≥n de descarga completa
                const downloadBtn = document.getElementById('download-btn');
                if (progressPercentage === 100) {
                    downloadBtn.style.display = 'inline-flex';
                    // Mostrar el sistema de calificaci√≥n cuando se completan todas las preguntas
                    ratingContainer.style.display = 'block';
                    // Esperar un momento para que la animaci√≥n de la barra de progreso termine
                    setTimeout(() => {
                        showCongratsPopup();
                    }, 1000);
                } else {
                    downloadBtn.style.display = 'none';
                    ratingContainer.style.display = 'none';
                }
            }
            
            // Funci√≥n para mostrar el popup de felicitaciones
            function showCongratsPopup() {
                congratsPopup.style.display = 'flex';
                
                // Generar confeti
                generateConfetti();
            }

            // Funci√≥n para generar confeti
            function generateConfetti() {
                const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
                
                // Limpiar confeti existente
                const existingConfetti = document.querySelectorAll('.confetti');
                existingConfetti.forEach(c => c.remove());
                
                // Crear 100 piezas de confeti
                for (let i = 0; i < 100; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    
                    // Posici√≥n aleatoria
                    const left = Math.random() * 100;
                    const animationDelay = Math.random() * 5;
                    const animationDuration = 3 + Math.random() * 3;
                    
                    // Color aleatorio
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    
                    // Tama√±o aleatorio
                    const size = 5 + Math.random() * 10;
                    
                    // Estilo del confeti
                    confetti.style.left = `${left}%`;
                    confetti.style.backgroundColor = color;
                    confetti.style.width = `${size}px`;
                    confetti.style.height = `${size}px`;
                    confetti.style.animationDelay = `${animationDelay}s`;
                    confetti.style.animationDuration = `${animationDuration}s`;
                    
                    // Forma aleatoria (cuadrado o c√≠rculo)
                    if (Math.random() > 0.5) {
                        confetti.style.borderRadius = '50%';
                    }
                    
                    congratsPopup.appendChild(confetti);
                }
            }

            // Funci√≥n para descargar todo el libro en PDF
            function downloadCompleteBook() {
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const margin = 15;
                
                // Funci√≥n para dibujar el marco
                const drawFrame = () => {
                    doc.setDrawColor(106, 90, 205);
                    doc.setLineWidth(0.5);
                    doc.roundedRect(
                        margin, 
                        margin, 
                        pageWidth - 2 * margin, 
                        pageHeight - 2 * margin, 
                        3, 3, 'S'
                    );
                    
                    doc.setLineWidth(0.3);
                    doc.roundedRect(
                        margin + 5, 
                        margin + 5, 
                        pageWidth - 2 * margin - 10, 
                        pageHeight - 2 * margin - 10, 
                        2, 2, 'S'
                    );
                    
                    // Pie de p√°gina
                    doc.setFontSize(10);
                    doc.setTextColor(106, 90, 205);
                    doc.text(
                        'CU√âNTAME TU HISTORIA', 
                        pageWidth / 2, 
                        pageHeight - margin / 2, 
                        { align: 'center' }
                    );
                };
                
                let yPos = margin + 20;
                
                // Dibujar marco en la primera p√°gina
                drawFrame();
                
                // T√≠tulo del libro
                doc.setFontSize(22);
                doc.setTextColor(106, 90, 205);
                doc.text('Mi Historia para mi Hijo', pageWidth / 2, yPos, { align: 'center' });
                yPos += 15;
                
                // Subt√≠tulo
                doc.setFontSize(16);
                doc.setTextColor(0, 0, 0);
                doc.text('Un regalo de amor para cuando seas mayor', pageWidth / 2, yPos, { align: 'center' });
                yPos += 20;
                
                // Autor
                const parentName = document.querySelector('.parent-btn.active').textContent.trim();
                doc.setFontSize(14);
                doc.text(`Por: ${parentName}`, pageWidth / 2, yPos, { align: 'center' });
                yPos += 25;
                
                // Fecha
                doc.setFontSize(12);
                doc.text(`Creado el: ${new Date().toLocaleDateString()}`, pageWidth / 2, yPos, { align: 'center' });
                yPos += 30;
                
                // √çndice
                doc.setFontSize(16);
                doc.setTextColor(106, 90, 205);
                doc.text('√çndice', margin + 10, yPos);
                yPos += 10;
                
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                
                // Agrupar entradas por categor√≠a
                const categories = {};
                const categoryNames = {
                    'infancia': 'Ni√±ez',
                    'adolescencia': 'Adolescencia',
                    'familia': 'Familia',
                    'educacion': 'Educaci√≥n',
                    'hobbies': 'Hobbies',
                    'deporte': 'Deporte',
                    'musica': 'M√∫sica',
                    'amor': 'Amor',
                    'trabajo': 'Trabajo',
                    'viajes': 'Viajes',
                    'consejos': 'Consejos',
                    'momentos': 'Momentos Dif√≠ciles',
                    'tecnologia': 'Tecnolog√≠a y √âpoca',
                    'sue√±os': 'Sue√±os y Metas',
                    'creencias': 'Creencias y Valores',
                    'mensajes': 'Mensajes Futuros'
                };
                
                for (const category in categoryNames) {
                    categories[category] = [];
                }
                
                entries.forEach(entry => {
                    const question = questions.find(q => q.id === entry.questionId);
                    if (question) {
                        categories[question.category].push(entry);
                    }
                });
                
                // Secci√≥n para cada categor√≠a
                Object.keys(categories).forEach(category => {
                    const categoryEntries = categories[category];
                    
                    if (categoryEntries.length > 0) {
                        // Agregar nueva p√°gina si es necesario
                        if (yPos > pageHeight - margin - 20) {
                            doc.addPage();
                            yPos = margin + 20;
                            drawFrame();
                        }
                        
                        // T√≠tulo de la categor√≠a
                        doc.setFontSize(18);
                        doc.setTextColor(106, 90, 205);
                        doc.text(categoryNames[category], margin + 10, yPos);
                        yPos += 15;
                        
                        // Entradas de la categor√≠a
                        doc.setFontSize(12);
                        doc.setTextColor(0, 0, 0);
                        
                        categoryEntries.forEach(entry => {
                            // Agregar nueva p√°gina si es necesario
                            if (yPos > pageHeight - margin - 20) {
                                doc.addPage();
                                yPos = margin + 20;
                                drawFrame();
                            }
                            
                            // Pregunta
                            doc.setFontSize(14);
                            doc.setTextColor(106, 90, 205);
                            doc.text(entry.question, margin + 10, yPos, { maxWidth: pageWidth - 2 * margin - 20 });
                            yPos += 10;
                            
                            // Fecha
                            doc.setFontSize(10);
                            doc.setTextColor(100, 100, 100);
                            doc.text(formatDate(entry.date, true), margin + 10, yPos);
                            yPos += 10;
                            
                            // Respuesta
                            doc.setFontSize(12);
                            doc.setTextColor(0, 0, 0);
                            
                            const lines = doc.splitTextToSize(entry.answer, pageWidth - 2 * margin - 20);
                            doc.text(lines, margin + 10, yPos);
                            yPos += (lines.length * 6) + 15;
                        });
                        
                        // Espacio entre categor√≠as
                        yPos += 10;
                    }
                });
                
                // Guardar PDF
                doc.save(`Mi Historia para mi Hijo - ${parentName}.pdf`);
                
                // Marcar que el libro ha sido generado
                localStorage.setItem('bookGenerated', 'true');
                
                // Mostrar mensaje informativo
                showBookGeneratedMessage();
                
                // Cerrar el popup despu√©s de descargar
                congratsPopup.style.display = 'none';
                
                // Recargar preguntas para deshabilitar los botones de edici√≥n
                loadQuestions();
            }
            
            // Exportar secci√≥n a PDF
            function exportSectionToPdf(section) {
                // Verificar si todas las preguntas est√°n completadas para la secci√≥n de preguntas
                if (section === 'questions' && entries.length < questions.length) {
                    const unanswered = questions.length - entries.length;
                    alert(`No puedes exportar el PDF todav√≠a. Te faltan ${unanswered} preguntas por responder.`);
                    return;
                }
                
                let title, items;
                
                switch(section) {
                    case 'questions':
                        title = 'Mi Historia - Preguntas y Respuestas';
                        items = entries.map(entry => ({
                            title: entry.question,
                            date: entry.date,
                            content: entry.answer
                        }));
                        break;
                    case 'favorites':
                        title = 'Mis Favoritos';
                        const favoriteEntries = entries.filter(entry => favorites.includes(entry.id));
                        items = favoriteEntries.map(item => ({
                            title: item.question,
                            date: item.date,
                            content: item.answer,
                            type: item.type
                        }));
                        break;
                }
                
                if (items.length === 0) {
                    alert(`No hay contenido para exportar en la secci√≥n ${title}`);
                    return;
                }
                
                // Crear PDF con orientaci√≥n vertical y m√°rgenes m√°s grandes para el marco
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                // Configuraci√≥n del marco y estilo
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const margin = 15; // Margen para el marco
                
                // Funci√≥n para dibujar el marco decorativo
                const drawFrame = () => {
                    // Color del marco (puedes cambiarlo)
                    doc.setDrawColor(106, 90, 205); // Color morado
                    doc.setLineWidth(0.5);
                    
                    // Marco exterior
                    doc.roundedRect(
                        margin, 
                        margin, 
                        pageWidth - 2 * margin, 
                        pageHeight - 2 * margin, 
                        3, 3, 'S'
                    );
                    
                    // Marco interior m√°s fino
                    doc.setLineWidth(0.3);
                    doc.roundedRect(
                        margin + 5, 
                        margin + 5, 
                        pageWidth - 2 * margin - 10, 
                        pageHeight - 2 * margin - 10, 
                        2, 2, 'S'
                    );
                    
                    // Pie de p√°gina
                    doc.setFontSize(10);
                    doc.setTextColor(106, 90, 205);
                    doc.text(
                        'CU√âNTAME TU HISTORIA', 
                        pageWidth / 2, 
                        pageHeight - margin / 2, 
                        { align: 'center' }
                    );
                };
                
                let yPos = margin + 20;
                
                // Dibujar marco en la primera p√°gina
                drawFrame();
                
                // T√≠tulo
                doc.setFontSize(18);
                doc.setTextColor(106, 90, 205);
                doc.text(title, pageWidth / 2, yPos, { align: 'center' });
                yPos += 15;
                
                // Fecha de exportaci√≥n
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`Exportado el: ${new Date().toLocaleDateString()}`, pageWidth / 2, yPos, { align: 'center' });
                yPos += 20;
                
                // Contenido
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                
                items.forEach((item, index) => {
                    // Verificar si necesitamos una nueva p√°gina
                    if (yPos > pageHeight - margin - 20) {
                        doc.addPage();
                        yPos = margin + 20;
                        drawFrame(); // Dibujar marco en la nueva p√°gina
                    }
                    
                    // T√≠tulo de la entrada
                    doc.setFontSize(14);
                    doc.setTextColor(106, 90, 205);
                    doc.text(item.title, margin + 10, yPos, { maxWidth: pageWidth - 2 * margin - 20 });
                    yPos += 10;
                    
                    // Fecha
                    doc.setFontSize(10);
                    doc.setTextColor(100, 100, 100);
                    doc.text(formatDate(item.date, true), margin + 10, yPos);
                    yPos += 10;
                    
                    // Contenido
                    doc.setFontSize(12);
                    doc.setTextColor(0, 0, 0);
                    
                    // Dividir el texto en l√≠neas que quepan en el PDF
                    const lines = doc.splitTextToSize(item.content, pageWidth - 2 * margin - 20);
                    doc.text(lines, margin + 10, yPos);
                    yPos += (lines.length * 6) + 10;
                });
                
                // Guardar PDF
                doc.save(`${title}.pdf`);
            }
            
            // Cambiar de secci√≥n
            function switchSection(sectionId) {
                // Ocultar todas las secciones
                contentSections.forEach(section => {
                    section.classList.remove('active');
                });
                
                // Mostrar la secci√≥n seleccionada
                document.getElementById(sectionId).classList.add('active');
                
                // Actualizar botones de navegaci√≥n activos
                navButtons.forEach(button => {
                    button.classList.remove('active');
                    if (button.getAttribute('data-section') === sectionId) {
                        button.classList.add('active');
                    }
                });
                
                // Recargar contenido si es necesario
                if (sectionId === 'favorites') {
                    loadFavorites();
                } else if (sectionId === 'questions') {
                    loadQuestions();
                }
            }
            
            // Cargar entradas recientes
            function loadRecentEntries() {
                recentEntriesGrid.innerHTML = '';
                
                // Ordenar entradas por fecha (m√°s recientes primero)
                const sortedEntries = [...entries].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Mostrar las 6 m√°s recientes
                const recentEntries = sortedEntries.slice(0, 6);
                
                if (recentEntries.length === 0) {
                    recentEntriesGrid.innerHTML = '<p class="no-entries">A√∫n no hay entradas. ¬°Empieza a escribir! ‚úçÔ∏è</p>';
                    return;
                }
                
                recentEntries.forEach(entry => {
                    const entryCard = createEntryCard(entry);
                    recentEntriesGrid.appendChild(entryCard);
                });
            }
            
            // Cargar preguntas
            function loadQuestions(category = 'all') {
                questionsGrid.innerHTML = '';
                
                const filteredQuestions = category === 'all' 
                    ? questions 
                    : questions.filter(q => q.category === category);
                
                filteredQuestions.forEach(question => {
                    const questionCard = createQuestionCard(question);
                    questionsGrid.appendChild(questionCard);
                });
            }
            
            // Filtrar preguntas por categor√≠a
            function filterQuestionsByCategory(category) {
                loadQuestions(category);
            }
            
            // Cargar favoritos
            function loadFavorites() {
                favoritesGrid.innerHTML = '';
                
                if (favorites.length === 0) {
                    favoritesGrid.innerHTML = '<p class="no-entries">A√∫n no hay entradas favoritas. ‚≠ê</p>';
                    return;
                }
                
                // Combinar entradas y recuerdos favoritos
                const favoriteEntries = entries.filter(entry => favorites.includes(entry.id));
                
                const allFavorites = [...favoriteEntries].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                allFavorites.forEach(item => {
                    const favoriteCard = createEntryCard(item);
                    favoritesGrid.appendChild(favoriteCard);
                });
            }
            
            // Crear tarjeta de entrada
            function createEntryCard(entry) {
                const entryCard = document.createElement('div');
                entryCard.className = 'entry-card';
                entryCard.setAttribute('data-id', entry.id);
                
                const formattedDate = formatDate(entry.date);
                
                entryCard.innerHTML = `
                    <div class="entry-header">
                        <h3>${entry.question}</h3>
                        <p class="entry-date">${formattedDate}</p>
                    </div>
                    <div class="entry-content">
                        ${truncateText(entry.answer, 100)}
                    </div>
                    <div class="entry-actions">
                        <span><i class="fas ${favorites.includes(entry.id) ? 'fa-star' : 'far fa-star'}"></i></span>
                        <span>Leer m√°s</span>
                    </div>
                `;
                
                entryCard.addEventListener('click', () => {
                    openEntryModal(entry);
                });
                
                return entryCard;
            }
            
            // Crear tarjeta de pregunta
            function createQuestionCard(question) {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                
                // Verificar si ya hay una entrada para esta pregunta
                const existingEntry = entries.find(entry => entry.questionId === question.id);
                const bookGenerated = isBookGenerated();
                
                questionCard.innerHTML = `
                    <h3><i class="fas ${question.icon}"></i> ${question.text}</h3>
                    <p>${existingEntry ? '‚úÖ Ya has respondido esta pregunta' : '‚ùå A√∫n no has respondido esta pregunta'}</p>
                    <button class="answer-btn" ${bookGenerated && existingEntry ? 'disabled' : ''}>
                        ${existingEntry ? '<i class="fas fa-edit"></i> Ver/Editar respuesta' : '<i class="fas fa-pen"></i> Responder'}
                    </button>
                `;
                
                const answerBtn = questionCard.querySelector('.answer-btn');
                answerBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (existingEntry) {
                        openEntryModal(existingEntry);
                    } else {
                        openQuestionModal(question);
                    }
                });
                
                return questionCard;
            }
            
            // Abrir modal de pregunta
            function openQuestionModal(question) {
                if (isBookGenerated()) {
                    alert('El libro ya ha sido generado. No puedes editar las respuestas.');
                    return;
                }
                
                currentQuestion = question;
                modalQuestionTitle.textContent = question.text;
                modalQuestionAnswer.value = '';
                questionModal.style.display = 'flex';
                isEditing = false;
            }
            
            // Abrir modal de entrada
            function openEntryModal(entry) {
                currentEntry = entry;
                entryModalTitle.textContent = entry.question;
                entryModalDate.textContent = formatDate(entry.date, true);
                entryModalContent.textContent = entry.answer;
                
                // Actualizar bot√≥n de favorito
                const favoriteIcon = toggleFavoriteBtn.querySelector('i');
                if (favorites.includes(entry.id)) {
                    toggleFavoriteBtn.classList.add('active');
                    favoriteIcon.classList.remove('far');
                    favoriteIcon.classList.add('fas');
                } else {
                    toggleFavoriteBtn.classList.remove('active');
                    favoriteIcon.classList.remove('fas');
                    favoriteIcon.classList.add('far');
                }
                
                // Configurar bot√≥n de editar
                editEntryBtn.style.display = isBookGenerated() ? 'none' : 'inline-flex';
                
                entryModal.style.display = 'flex';
                isEditing = false;
            }
            
            // Cerrar todos los modales
            function closeAllModals() {
                questionModal.style.display = 'none';
                memoryModal.style.display = 'none';
                entryModal.style.display = 'none';
                congratsPopup.style.display = 'none';
                infoModal.style.display = 'none';
                downloadModal.style.display = 'none';
            }
            
            // Guardar respuesta a pregunta
            function saveQuestionAnswer() {
                const answer = modalQuestionAnswer.value.trim();
                
                if (!answer) {
                    alert('Por favor, escribe una respuesta. ‚úçÔ∏è');
                    return;
                }
                
                // Crear nueva entrada o actualizar existente
                const existingEntryIndex = entries.findIndex(entry => entry.questionId === currentQuestion.id);
                
                const newEntry = {
                    id: isEditing ? currentEntry.id : Date.now().toString(),
                    questionId: currentQuestion.id,
                    question: currentQuestion.text,
                    answer: answer,
                    date: isEditing ? currentEntry.date : new Date().toISOString(),
                    type: 'entry'
                };
                
                if (existingEntryIndex !== -1) {
                    entries[existingEntryIndex] = newEntry;
                } else {
                    entries.push(newEntry);
                }
                
                // Guardar en localStorage
                saveUserData();
                
                // Recargar secciones relevantes
                loadRecentEntries();
                loadQuestions();
                updateProgressBar();
                
                // Cerrar modal
                closeAllModals();
                
                // Mostrar mensaje de √©xito
                alert('¬°Respuesta guardada con √©xito! ‚úÖ');
            }
            
            // Alternar favorito
            function toggleFavorite() {
                if (!currentEntry) return;
                
                const index = favorites.indexOf(currentEntry.id);
                
                if (index === -1) {
                    // A√±adir a favoritos
                    favorites.push(currentEntry.id);
                    toggleFavoriteBtn.classList.add('active');
                    const icon = toggleFavoriteBtn.querySelector('i');
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                } else {
                    // Quitar de favoritos
                    favorites.splice(index, 1);
                    toggleFavoriteBtn.classList.remove('active');
                    const icon = toggleFavoriteBtn.querySelector('i');
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                }
                
                // Guardar en localStorage
                saveUserData();
                
                // Actualizar la vista si estamos en la secci√≥n de favoritos
                if (document.getElementById('favorites').classList.contains('active')) {
                    loadFavorites();
                }
            }
            
            // Editar entrada
            function editEntry() {
                if (!currentEntry) return;
                
                if (isBookGenerated()) {
                    alert('El libro ya ha sido generado. No puedes editar las respuestas.');
                    return;
                }
                
                // Buscar la pregunta correspondiente
                currentQuestion = questions.find(q => q.id === currentEntry.questionId);
                
                if (!currentQuestion) {
                    alert('No se pudo encontrar la pregunta original. ‚ùå');
                    return;
                }
                
                // Configurar el modal de pregunta para edici√≥n
                modalQuestionTitle.textContent = currentQuestion.text;
                modalQuestionAnswer.value = currentEntry.answer;
                questionModal.style.display = 'flex';
                isEditing = true;
                
                // Cerrar el modal de entrada
                entryModal.style.display = 'none';
            }
            
            // Funciones para el sistema de calificaci√≥n
            function setRating(rating) {
                selectedRating = rating;
                highlightStars(rating);
            }

            function highlightStars(rating) {
                ratingStars.forEach(star => {
                    const starRating = parseInt(star.getAttribute('data-rating'));
                    if (starRating <= rating) {
                        star.classList.add('active');
                    } else {
                        star.classList.remove('active');
                    }
                });
            }

            function sendRating() {
                if (selectedRating === 0) {
                    alert('Por favor selecciona una calificaci√≥n antes de enviar.');
                    return;
                }

                const feedback = ratingFeedback.value.trim();
                const parentName = document.querySelector('.parent-btn.active').textContent.trim();
                const whatsappNumber = "1234567890"; // Reemplaza con el n√∫mero de WhatsApp real
                
                // Crear mensaje para WhatsApp
                const message = `Calificaci√≥n de la aplicaci√≥n:\n\n` +
                                `‚≠ê Calificaci√≥n: ${selectedRating}/5\n\n` +
                                `üìù Comentarios: ${feedback || 'Sin comentarios'}\n\n` +
                                `üë§ Usuario: ${parentName}`;
                
                // Codificar el mensaje para URL
                const encodedMessage = encodeURIComponent(message);
                
                // Crear enlace de WhatsApp
                const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
                
                // Abrir enlace en una nueva pesta√±a
                window.open(whatsappUrl, '_blank');
                
                // Mostrar mensaje de agradecimiento
                alert('¬°Gracias por tu calificaci√≥n! Tu opini√≥n nos ayuda a mejorar la aplicaci√≥n. üòä');
                
                // Limpiar el formulario
                selectedRating = 0;
                highlightStars(0);
                ratingFeedback.value = '';
            }
            
            // Funciones auxiliares
            function formatDate(dateString, includeTime = false) {
                const options = { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    ...(includeTime && { hour: '2-digit', minute: '2-digit' })
                };
                return new Date(dateString).toLocaleDateString('es-ES', options);
            }
            
            function truncateText(text, maxLength) {
                if (text.length <= maxLength) return text;
                return text.substring(0, maxLength) + '...';
            }
            
            function dataURLtoBlob(dataurl) {
                const arr = dataurl.split(',');
                const mime = arr[0].match(/:(.*?);/)[1];
                const bstr = atob(arr[1]);
                let n = bstr.length;
                const u8arr = new Uint8Array(n);
                
                while(n--) {
                    u8arr[n] = bstr.charCodeAt(n);
                }
                
                return new Blob([u8arr], {type: mime});
            }
        });
    </script>
</body>
</html>
